kind: ConfigMap
apiVersion: v1
metadata:
  name: sysprep-wordpress-be
  namespace: demo-hybrid
data:
  Autounattend.xml: |-
    <?xml version="1.0" encoding="utf-8"?>
    <unattend xmlns="urn:schemas-microsoft-com:unattend">
        <!-- Windows PE phase -->
        <settings pass="windowsPE">
            <component name="Microsoft-Windows-Setup" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS" xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                <!-- Disk configuration and installation settings -->
                <DiskConfiguration>
                    <Disk wcm:action="add">
                        <CreatePartitions>
                            <CreatePartition wcm:action="add">
                                <Order>1</Order>
                                <Size>100</Size>
                                <Type>EFI</Type>
                            </CreatePartition>
                            <CreatePartition wcm:action="add">
                                <Order>2</Order>
                                <Size>128</Size>
                                <Type>MSR</Type>
                            </CreatePartition>
                            <CreatePartition wcm:action="add">
                                <Order>3</Order>
                                <Extend>true</Extend>
                                <Type>Primary</Type>
                            </CreatePartition>
                        </CreatePartitions>
                        <ModifyPartitions>
                            <ModifyPartition wcm:action="add">
                                <Format>FAT32</Format>
                                <Label>System</Label>
                                <Order>1</Order>
                                <PartitionID>1</PartitionID>
                            </ModifyPartition>
                            <ModifyPartition wcm:action="add">
                                <Order>2</Order>
                                <PartitionID>2</PartitionID>
                            </ModifyPartition>
                            <ModifyPartition wcm:action="add">
                                <Order>3</Order>
                                <PartitionID>3</PartitionID>
                                <Letter>C</Letter>
                                <Label>OS</Label>
                                <Format>NTFS</Format>
                            </ModifyPartition>
                        </ModifyPartitions>
                        <DiskID>0</DiskID>
                        <WillWipeDisk>true</WillWipeDisk>
                    </Disk>
                </DiskConfiguration>
                <ImageInstall>
                    <OSImage>
                        <InstallFrom>
                            <MetaData>
                                <Key>/IMAGE/INDEX</Key>
                                <Value>2</Value>
                            </MetaData>
                        </InstallFrom>
                        <InstallTo>
                            <DiskID>0</DiskID>
                            <PartitionID>3</PartitionID>
                        </InstallTo>
                    </OSImage>
                </ImageInstall>
                <UserData>
                    <AcceptEula>true</AcceptEula>
                    <FullName>Administrator</FullName>
                    <Organization>Organization</Organization>
                    <ProductKey>
                        <Key>NF4JM-Q8GD3-XJFCT-WBBGY-G3DVJ</Key>
                    </ProductKey>
                </UserData>
                <EnableFirewall>true</EnableFirewall>
            </component>
            <component name="Microsoft-Windows-PnpCustomizationsWinPE" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS" xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                <DriverPaths>
                    <PathAndCredentials wcm:action="add" wcm:keyValue="1">
                        <Path>E:\</Path>
                    </PathAndCredentials>
                </DriverPaths>
            </component>
            <component name="Microsoft-Windows-International-Core-WinPE" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS" xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                <SetupUILanguage>
                    <UILanguage>en-US</UILanguage>
                </SetupUILanguage>
                <InputLocale>0c09:00000409</InputLocale>
                <SystemLocale>en-US</SystemLocale>
                <UILanguage>en-US</UILanguage>
                <UILanguageFallback>en-US</UILanguageFallback>
                <UserLocale>en-US</UserLocale>
            </component>
        </settings>
        <!-- Offline Servicing phase -->
        <settings pass="offlineServicing">
            <component name="Microsoft-Windows-LUA-Settings" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS" xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                <EnableLUA>false</EnableLUA>
            </component>
        </settings>
        <!-- Generalize phase -->
        <settings pass="generalize">
            <component name="Microsoft-Windows-Security-SPP" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS" xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                <SkipRearm>1</SkipRearm>
            </component>
        </settings>

        <!-- Specialize phase -->
        <settings pass="specialize">
            <component name="Microsoft-Windows-International-Core" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS" xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                <InputLocale>0409:00000409</InputLocale>
                <SystemLocale>en-US</SystemLocale>
                <UILanguage>en-US</UILanguage>
                <UILanguageFallback>en-US</UILanguageFallback>
                <UserLocale>en-US</UserLocale>
            </component>
            <component name="Microsoft-Windows-Security-SPP-UX" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS" xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                <SkipAutoActivation>true</SkipAutoActivation>
            </component>
            <component name="Microsoft-Windows-SQMApi" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS" xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                <CEIPEnabled>0</CEIPEnabled>
            </component>
            <component name="Microsoft-Windows-Shell-Setup" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS" xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                <ComputerName>wordpress-be</ComputerName>
                <ProductKey>NF4JM-Q8GD3-XJFCT-WBBGY-G3DVJ</ProductKey>
            </component>
        </settings>

        <!-- OOBE System phase -->
        <settings pass="oobeSystem">
            <component name="Microsoft-Windows-Shell-Setup" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS" xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                <AutoLogon>
                    <Password>
                        <Value>1776t@Hd3R</Value>
                        <PlainText>true</PlainText>
                    </Password>
                    <Enabled>true</Enabled>
                    <Username>Administrator</Username>
                </AutoLogon>
                <OOBE>
                    <HideEULAPage>true</HideEULAPage>
                    <HideLocalAccountScreen>true</HideLocalAccountScreen>
                    <HideOEMRegistrationScreen>true</HideOEMRegistrationScreen>
                    <HideOnlineAccountScreens>true</HideOnlineAccountScreens>
                    <HideWirelessSetupInOOBE>true</HideWirelessSetupInOOBE>
                    <NetworkLocation>Work</NetworkLocation>
                    <ProtectYourPC>3</ProtectYourPC>
                    <SkipMachineOOBE>true</SkipMachineOOBE>
                    <SkipUserOOBE>true</SkipUserOOBE>
                </OOBE>
                <RegisteredOrganization>Organization</RegisteredOrganization>
                <RegisteredOwner>Owner</RegisteredOwner>
                <DisableAutoDaylightTimeSet>false</DisableAutoDaylightTimeSet>
                <TimeZone>Eastern Standard Time</TimeZone>
                <FirstLogonCommands>
                    <SynchronousCommand wcm:action="add">
                        <Order>1</Order>
                        <Description>Execute final powershell</Description>
                        <RequiresUserInput>false</RequiresUserInput>
                        <CommandLine>powershell -ExecutionPolicy Bypass -NoExit -NoProfile F:\post-install.ps1</CommandLine>
                    </SynchronousCommand>
                </FirstLogonCommands>
                <UserAccounts>
                    <AdministratorPassword>
                        <Value>1776t@Hd3R</Value>
                        <PlainText>true</PlainText>
                    </AdministratorPassword>
                    <LocalAccounts>
                        <LocalAccount wcm:action="add">
                            <Description>Administrator</Description>
                            <DisplayName>Administrator</DisplayName>
                            <Group>Administrators</Group>
                            <Name>Administrator</Name>
                        </LocalAccount>
                    </LocalAccounts>
                </UserAccounts>
            </component>
        </settings>
    </unattend>
  post-install.ps1: |-
    function Invoke-WebRequestWithRetry {
        param (
            [string]$Uri,
            [string]$OutFile,
            [int]$RetryCount = 5,
            [int]$RetryDelay = 10
        )
    
        $attempt = 0
        while ($attempt -lt $RetryCount) {
            try {
                Write-Host "Attempting download ($($attempt + 1)/$RetryCount): $Uri"
                Invoke-WebRequest -Uri $Uri -OutFile $OutFile -ErrorAction Stop
                Write-Host "Download succeeded: $Uri"
                return
            } catch {
                Write-Host "Attempt $($attempt + 1) failed: $_.Exception.Message"
                Start-Sleep -Seconds $RetryDelay
                $attempt++
            }
        }
    
        throw "Failed to download $Uri after $RetryCount attempts."
    }
    
    # Uncomment below line for Debugging and Troubleshooting
    #Set-PSDebug -Trace 1
    #####################################
    # Perform some basic configurations #
    #####################################

    Write-Host "Performing some basic configurations"
    # Configure legacy control panel view
    Start-Process reg -Wait -ArgumentList 'add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\ControlPanel" /v StartupPage /t REG_DWORD /d 1 /f'
    # Modify control panel icon size
    Start-Process reg -Wait -ArgumentList 'add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\ControlPanel" /v AllItemsIconView /t REG_DWORD /d 0 /f'
    # Prevent password expiration
    Start-Process wmic -Wait -ArgumentList 'useraccount where name="Administrator" set PasswordExpires=false'
    
    Write-Host "Setting all network profiles to private"
    $networkProfile = Get-NetConnectionProfile
    Set-NetConnectionProfile -InterfaceAlias $networkProfile.InterfaceAlias -NetworkCategory Public

    Write-Host "Renaming network adapters"
    $networks = Get-NetAdapter
    foreach ($network in $networks) {
        try {
            $dnsSuffix = (Get-DnsClient -InterfaceAlias $network.Name | Select-Object -ExpandProperty ConnectionSpecificSuffix)

            if ($dnsSuffix -like 'airgap*') {
                $newName = "Airgap Network"
            } elseif ($dnsSuffix -like 'dota-lab*') {
                $newName = "Lab Network"
            } elseif ($dnsSuffix -like '*.svc.cluster.local') {
                $newName = "Pod Network"
            } else {
                $newName = $null
            }

            if ($newName) {
                Rename-NetAdapter -Name $network.Name -NewName $newName
                Write-Host "Renamed $($network.Name) to $newName"
            }
        } catch {
            Write-Host "An error occurred while processing $($network.Name), but continuing to the next command."
        }
    }

    Write-Host "Installing additional drivers"
    # Install all remaining VirtIO drivers
    Start-Process msiexec -Wait -ArgumentList '/i E:\virtio-win-gt-x64.msi /qn /passive /norestart'
    # Install VirtIO Guest Tools
    Start-Process msiexec -Wait -ArgumentList '/i E:\virtio-win-guest-tools.exe /qn /passive /norestart'
    # Install qemu Guest Agent
    Start-Process msiexec -Wait -ArgumentList '/i E:\guest-agent\qemu-ga-x86_64.msi /qn /passive /norestart'
    # Install winfsp Guest Agent
    Start-Process msiexec -Wait -ArgumentList '/i E:\winfsp-1.12.22339.msi /qn /passive /norestart'

    Write-Host "Enabling RDP"
    # Enable RDP
    Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -name "fDenyTSConnections" -value 0
    Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
    #####################################
    # Perform custom post-install steps #
    #####################################

    Write-Host "Performing custom setup"
    Write-Host "Downloading MySQL Installer - Please be patient, this may take a few minutes..."
    Invoke-WebRequestWithRetry -Uri 'http://bills-web-server.apps.tacos.dota-lab.iad.redhat.com/mysql-8.4.0-winx64.msi' -OutFile "$env:USERPROFILE\Downloads\mysql-8.4.0-winx64.msi"
    #Invoke-WebRequestWithRetry -Uri 'https://dev.mysql.com/get/Downloads/MySQL-8.4/mysql-8.4.0-winx64.msi' -OutFile "$env:USERPROFILE\Downloads\mysql-8.4.0-winx64.msi"
    Write-Host "Downloading Visual Studio 2019 Redistributables"
    Invoke-WebRequestWithRetry -Uri 'http://bills-web-server.apps.tacos.dota-lab.iad.redhat.com/VC_redist.x64.exe' -OutFile "$env:USERPROFILE\Downloads\vc_redist.x64.exe"
    #Invoke-WebRequestWithRetry -Uri 'https://aka.ms/vs/17/release/vc_redist.x64.exe' -OutFile "$env:USERPROFILE\Downloads\vc_redist.x64.exe"
    Write-Host "Installing Visual Studio 2019 Redistributables"
    Start-Process -FilePath "$env:USERPROFILE\Downloads\vc_redist.x64.exe" -ArgumentList '/install', '/quiet', '/norestart' -Wait -PassThru
    Write-Host "Installing MySQL"
    Start-Process -FilePath 'msiexec.exe' -ArgumentList "/i $env:USERPROFILE\Downloads\mysql-8.4.0-winx64.msi /qn" -Wait -PassThru

    Write-Host "Creating MySQL Data Directory"
    # Ensure the MySQL data directory exists
    New-Item -ItemType Directory -Force -Path "C:\ProgramData\MySQL\MySQL Server 8.0\Data"
    New-Item -ItemType Directory -Force -Path "C:\ProgramData\MySQL\MySQL Server 8.0\Uploads"

    Write-Host "Copying MySQL Configuration File"
    # Copy the my.ini file to the appropriate directory
    Copy-Item -Path "F:\my.ini" -Destination "C:\ProgramData\MySQL\MySQL Server 8.0\my.ini" -Force

    Write-Host "Initializing MySQL Data Directory"
    # Initialize the MySQL data directory
    Start-Process -FilePath "C:\Program Files\MySQL\MySQL Server 8.4\bin\mysqld.exe" -ArgumentList "--initialize-insecure --basedir=`"C:\Program Files\MySQL\MySQL Server 8.4`" --datadir=`"C:\ProgramData\MySQL\MySQL Server 8.0\Data`"" -Wait -PassThru

    Write-Host "Creating MySQL Service"
    # Create the MySQL service with the new configuration file
    Start-Process -FilePath "C:\Program Files\MySQL\MySQL Server 8.4\bin\mysqld.exe" -ArgumentList "--install MySQL80 --defaults-file=`"C:\ProgramData\MySQL\MySQL Server 8.0\my.ini`"" -Wait -PassThru

    Write-Host "Initializing MySQL Data Directory"
    # Initialize the MySQL data directory
    & "C:\Program Files\MySQL\MySQL Server 8.4\bin\mysqld.exe" --initialize-insecure --basedir="C:\Program Files\MySQL\MySQL Server 8.4" --datadir="C:\ProgramData\MySQL\MySQL Server 8.0\Data"

    Write-Host "Creating MySQL Service"
    # Create the MySQL service with the new configuration file
    & "C:\Program Files\MySQL\MySQL Server 8.4\bin\mysqld.exe" --install MySQL80 --defaults-file="C:\ProgramData\MySQL\MySQL Server 8.0\my.ini"
    
    Write-Host "Allowing MySQL traffic through firewall"
    # Allow MySQL traffic through the firewall
    New-NetFirewallRule -DisplayName "MySQL Server" -Direction Inbound -Protocol TCP -LocalPort 3306 -Action Allow

    Write-Host "Starting MySQL Service"
    # Start the MySQL service
    Start-Service -Name "MySQL80"

    Write-Host "Configuring MySQL"
    # Wait for MySQL service to be available
    Start-Sleep -Seconds 10

    Write-Host "Executing provided SQL file"
    # Execute the provided SQL file
    & "C:\Program Files\MySQL\MySQL Server 8.4\bin\mysql.exe" -u root -e "source F:\mysql_setup.sql"

    Write-Host "Custom setup completed"
  my.ini: |-
    # Other default tuning values
    # MySQL Server Instance Configuration File
    # ----------------------------------------------------------------------
    # Generated by the MySQL Server Instance Configuration Wizard
    #
    #
    # Installation Instructions
    # ----------------------------------------------------------------------
    #
    # On Linux you can copy this file to /etc/my.cnf to set global options,
    # mysql-data-dir/my.cnf to set server-specific options
    # (@localstatedir@ for this installation) or to
    # ~/.my.cnf to set user-specific options.
    #
    # On Windows, when MySQL has been installed using MySQL Installer you
    # should keep this file in the ProgramData directory of your server
    # (e.g. C:\ProgramData\MySQL\MySQL Server X.Y). To make sure the server
    # reads the config file, use the startup option "--defaults-file". 
    #
    # To run the server from the command line, execute this in a 
    # command line shell, e.g.
    # mysqld --defaults-file="C:\Program Files\MySQL\MySQL Server X.Y\my.ini"
    #
    # To install the server as a Windows service manually, execute this in a 
    # command line shell, e.g.
    # mysqld --install MySQLXY --defaults-file="C:\Program Files\MySQL\MySQL Server X.Y\my.ini"
    #
    # And then execute this in a command line shell to start the server, e.g.
    # net start MySQLXY
    #
    #
    # Guidelines for editing this file
    # ----------------------------------------------------------------------
    #
    # In this file, you can use all long options that the program supports.
    # If you want to know the options a program supports, start the program
    # with the "--help" option.
    #
    # More detailed information about the individual options can also be
    # found in the manual.
    #
    # For advice on how to change settings please see
    # https://dev.mysql.com/doc/refman/8.0/en/server-configuration-defaults.html
    #
    #
    # CLIENT SECTION
    # ----------------------------------------------------------------------
    #
    # The following options will be read by MySQL client applications.
    # Note that only client applications shipped by MySQL are guaranteed
    # to read this section. If you want your own MySQL client program to
    # honor these values, you need to specify it as an option during the
    # MySQL client library initialization.
    #
    [client]
    
    # pipe=
    
    # socket=MYSQL
    
    port=3306
    
    [mysql]
    no-beep
    
    # default-character-set=
    
    # SERVER SECTION
    # ----------------------------------------------------------------------
    #
    # The following options will be read by the MySQL Server. Make sure that
    # you have installed the server correctly (see above) so it reads this 
    # file.
    #
    # server_type=2
    [mysqld]
    
    # The next three options are mutually exclusive to SERVER_PORT below.
    # skip-networking
    # enable-named-pipe
    # shared-memory
    
    # shared-memory-base-name=MYSQL
    
    # The Pipe the MySQL Server will use.
    # socket=MYSQL
    
    # The access control granted to clients on the named pipe created by the MySQL Server.
    # named-pipe-full-access-group=
    
    # The TCP/IP Port the MySQL Server will listen on
    port=3306
    
    # Path to installation directory. All paths are usually resolved relative to this.
    # basedir="C:/Program Files/MySQL/MySQL Server 8.0/"
    
    # Path to the database root
    datadir=C:/ProgramData/MySQL/MySQL Server 8.0\Data
    
    # The default character set that will be used when a new schema or table is
    # created and no character set is defined
    # character-set-server=
    
    
    # Administers multifactor authentication (MFA) capabilities. It applies to the authentication
    # factor-related clauses of CREATE USER and ALTER USER statements used to manage MySQL account
    # definitions, where "factor" corresponds to an authentication method or plugin associated
    # with an account.
    #authentication_policy=mysql_native_password
    
    # The default storage engine that will be used when create new tables when
    default-storage-engine=INNODB
    
    # The current server SQL mode, which can be set dynamically.
    # Modes affect the SQL syntax MySQL supports and the data validation checks it performs. This 
    # makes it easier to use MySQL in different environments and to use MySQL together with other 
    # database servers.
    sql-mode="ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION"
    
    # General and Slow logging.
    log-output=FILE
    
    general-log=0
    
    general_log_file="WORDPRESS-BE.log"
    
    slow-query-log=1
    
    slow_query_log_file="WORDPRESS-BE-slow.log"
    
    long_query_time=10
    
    # Error Logging.
    log-error="WORDPRESS-BE.err"
    
    # ***** Group Replication Related *****
    # Specifies the base name to use for binary log files. With binary logging
    # enabled, the server logs all statements that change data to the binary
    # log, which is used for backup and replication.
    log-bin="WORDPRESS-BE-bin"
    
    # ***** Group Replication Related *****
    # Specifies the server ID. For servers that are used in a replication topology,
    # you must specify a unique server ID for each replication server, in the
    # range from 1 to 2^32 âˆ’ 1. "Unique" means that each ID must be different
    # from every other ID in use by any other source or replica.
    server-id=1
    
    # Indicates how table and database names are stored on disk and used in MySQL.
    # Value 0 = Table and database names are stored on disk using the lettercase specified in the CREATE 
    #           TABLE or CREATE DATABASE statement. Name comparisons are case-sensitive. You should not 
    #           set this variable to 0 if you are running MySQL on a system that has case-insensitive file 
    #           names (such as Windows or macOS). If you force this variable to 0 with 
    #           --lower-case-table-names=0 on a case-insensitive file system and access MyISAM tablenames 
    #           using different lettercases, index corruption may result.
    # Value 1 = Table names are stored in lowercase on disk and name comparisons are not case-sensitive. 
    #           MySQL converts all table names to lowercase on storage and lookup. This behavior also applies 
    #           to database names and table aliases.
    # Value 2 = Table and database names are stored on disk using the lettercase specified in the CREATE TABLE 
    #           or CREATE DATABASE statement, but MySQL converts them to lowercase on lookup. Name comparisons 
    #           are not case-sensitive. This works only on file systems that are not case-sensitive! InnoDB 
    #           table names and view names are stored in lowercase, as for lower_case_table_names=1.
    lower_case_table_names=1
    
    # This variable is used to limit the effect of data import and export operations, such as 
    # those performed by the LOAD DATA and SELECT ... INTO OUTFILE statements and the 
    # LOAD_FILE() function. These operations are permitted only to users who have the FILE privilege.
    secure-file-priv="C:/ProgramData/MySQL/MySQL Server 8.0/Uploads"
    
    # The maximum amount of concurrent sessions the MySQL server will
    # allow. One of these connections will be reserved for a user with
    # SUPER privileges to allow the administrator to login even if the
    # connection limit has been reached.
    max_connections=151
    
    # The number of open tables for all threads. Increasing this value increases the number 
    # of file descriptors that mysqld requires.
    table_open_cache=4000
    
    # Defines the maximum amount of memory that can be occupied by the TempTable 
    # storage engine before it starts storing data on disk.
    temptable_max_ram=1G
    
    # Defines the maximum size of internal in-memory temporary tables created 
    # by the MEMORY storage engine and, as of MySQL 8.0.28, the TempTable storage 
    # engine. If an internal in-memory temporary table exceeds this size, it is 
    # automatically converted to an on-disk internal temporary table.
    tmp_table_size=705M
    
    # The storage engine for in-memory internal temporary tables (see Section 8.4.4, "Internal 
    # Temporary Table Use in MySQL"). Permitted values are TempTable (the default) and MEMORY.
    internal_tmp_mem_storage_engine=TempTable
    
    #*** MyISAM Specific options
    # The maximum size of the temporary file that MySQL is permitted to use while re-creating a 
    # MyISAM index (during REPAIR TABLE, ALTER TABLE, or LOAD DATA). If the file size would be 
    # larger than this value, the index is created using the key cache instead, which is slower. 
    # The value is given in bytes.
    myisam_max_sort_file_size=2146435072
    
    # The size of the buffer that is allocated when sorting MyISAM indexes during a REPAIR TABLE 
    # or when creating indexes with CREATE INDEX or ALTER TABLE.
    myisam_sort_buffer_size=2G
    
    # Size of the Key Buffer, used to cache index blocks for MyISAM tables.
    # Do not set it larger than 30% of your available memory, as some memory
    # is also required by the OS to cache rows. Even if you're not using
    # MyISAM tables, you should still set it to 8-64M as it will also be
    # used for internal temporary disk tables.
    key_buffer_size=8M
    
    # Each thread that does a sequential scan for a MyISAM table allocates a buffer 
    # of this size (in bytes) for each table it scans. If you do many sequential 
    # scans, you might want to increase this value, which defaults to 131072. The 
    # value of this variable should be a multiple of 4KB. If it is set to a value 
    # that is not a multiple of 4KB, its value is rounded down to the nearest multiple 
    # of 4KB.
    read_buffer_size=128K
    
    # This variable is used for reads from MyISAM tables, and, for any storage engine, 
    # for Multi-Range Read optimization.
    read_rnd_buffer_size=256K
    
    #*** INNODB Specific options ***
    # innodb_data_home_dir=
    
    # Use this option if you have a MySQL server with InnoDB support enabled
    # but you do not plan to use it. This will save memory and disk space
    # and speed up some things.
    # skip-innodb
    
    # If set to 1, InnoDB will flush (fsync) the transaction logs to the
    # disk at each commit, which offers full ACID behavior. If you are
    # willing to compromise this safety, and you are running small
    # transactions, you may set this to 0 or 2 to reduce disk I/O to the
    # logs. Value 0 means that the log is only written to the log file and
    # the log file flushed to disk approximately once per second. Value 2
    # means the log is written to the log file at each commit, but the log
    # file is only flushed to disk approximately once per second.
    innodb_flush_log_at_trx_commit=1
    
    # The size in bytes of the buffer that InnoDB uses to write to the log files on 
    # disk. The default value changed from 8MB to 16MB with the introduction of 32KB 
    # and 64KB innodb_page_size values. A large log buffer enables large transactions 
    # to run without the need to write the log to disk before the transactions commit. 
    # Thus, if you have transactions that update, insert, or delete many rows, making 
    # the log buffer larger saves disk I/O.
    innodb_log_buffer_size=16M
    
    # The size in bytes of the buffer pool, the memory area where InnoDB caches table 
    # and index data. The default value is 134217728 bytes (128MB). The maximum value 
    # depends on the CPU architecture; the maximum is 4294967295 (232-1) on 32-bit systems 
    # and 18446744073709551615 (264-1) on 64-bit systems. On 32-bit systems, the CPU 
    # architecture and operating system may impose a lower practical maximum size than the 
    # stated maximum. When the size of the buffer pool is greater than 1GB, setting 
    # innodb_buffer_pool_instances to a value greater than 1 can improve the scalability on 
    # a busy server.
    innodb_buffer_pool_size=128M
    
    # Defines the amount of disk space occupied by redo log files. This variable supersedes the 
    # innodb_log_files_in_group and innodb_log_file_size variables. 
    innodb_redo_log_capacity=100M
    
    # Defines the maximum number of threads permitted inside of InnoDB. A value 
    # of 0 (the default) is interpreted as infinite concurrency (no limit). This 
    # variable is intended for performance tuning on high concurrency systems.
    # InnoDB tries to keep the number of threads inside InnoDB less than or equal to 
    # the innodb_thread_concurrency limit. Once the limit is reached, additional threads 
    # are placed into a "First In, First Out" (FIFO) queue for waiting threads. Threads 
    # waiting for locks are not counted in the number of concurrently executing threads.
    innodb_thread_concurrency=9
    
    # The increment size (in MB) for extending the size of an auto-extend InnoDB system tablespace file when it becomes full.
    innodb_autoextend_increment=64
    
    # The number of regions that the InnoDB buffer pool is divided into.
    # For systems with buffer pools in the multi-gigabyte range, dividing the buffer pool into separate instances can improve concurrency,
    # by reducing contention as different threads read and write to cached pages.
    innodb_buffer_pool_instances=8
    
    # Determines the number of threads that can enter InnoDB concurrently.
    innodb_concurrency_tickets=5000
    
    # Specifies how long in milliseconds (ms) a block inserted into the old sublist must stay there after its first access before
    # it can be moved to the new sublist.
    innodb_old_blocks_time=1000
    
    # When this variable is enabled, InnoDB updates statistics during metadata statements.
    innodb_stats_on_metadata=0
    
    # When innodb_file_per_table is enabled (the default in 5.6.6 and higher), InnoDB stores the data and indexes for each newly created table
    # in a separate .ibd file, rather than in the system tablespace.
    innodb_file_per_table=1
    
    # Use the following list of values: 0 for crc32, 1 for strict_crc32, 2 for innodb, 3 for strict_innodb, 4 for none, 5 for strict_none.
    innodb_checksum_algorithm=0
    
    # If this is set to a nonzero value, all tables are closed every flush_time seconds to free up resources and
    # synchronize unflushed data to disk.
    # This option is best used only on systems with minimal resources.
    flush_time=0
    
    # The minimum size of the buffer that is used for plain index scans, range index scans, and joins that do not use
    # indexes and thus perform full table scans.
    join_buffer_size=256K
    
    # The maximum size of one packet or any generated or intermediate string, or any parameter sent by the
    # mysql_stmt_send_long_data() C API function.
    max_allowed_packet=64M
    
    # If more than this many successive connection requests from a host are interrupted without a successful connection,
    # the server blocks that host from performing further connections.
    max_connect_errors=100
    
    # The number of file descriptors available to mysqld from the operating system
    # Try increasing the value of this option if mysqld gives the error "Too many open files".
    open_files_limit=8161
    
    # If you see many sort_merge_passes per second in SHOW GLOBAL STATUS output, you can consider increasing the
    # sort_buffer_size value to speed up ORDER BY or GROUP BY operations that cannot be improved with query optimization
    # or improved indexing.
    sort_buffer_size=256K
    
    # Specify the maximum size of a row-based binary log event, in bytes.
    # Rows are grouped into events smaller than this size if possible. The value should be a multiple of 256.
    binlog_row_event_max_size=8K
    
    
    # If the value of this variable is greater than 0, a replica synchronizes its master.info file to disk.
    # (using fdatasync()) after every sync_source_info events.
    sync_source_info=10000
    
    # If the value of this variable is greater than 0, the MySQL server synchronizes its relay log to disk.
    # (using fdatasync()) after every sync_relay_log writes to the relay log.
    sync_relay_log=10000
    
    
    # Load mysql plugins at start."plugin_x ; plugin_y".
    # plugin_load
    
    # The TCP/IP Port the MySQL Server X Protocol will listen on.
    loose_mysqlx_port=33060
  mysql_setup.sql: |-
    ALTER USER 'root'@'localhost' IDENTIFIED BY '1776t@Hd3R';
    CREATE USER 'wordpress_user'@'%' IDENTIFIED BY '1776t@Hd3R';
    CREATE DATABASE wordpress_db;
    GRANT ALL PRIVILEGES ON wordpress_db.* TO 'wordpress_user'@'%';
    FLUSH PRIVILEGES;
